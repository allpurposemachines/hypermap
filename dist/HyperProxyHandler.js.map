{"version":3,"sources":["../src/HyperProxyHandler.js"],"sourcesContent":["// import HyperlistProxy from \"./HyperlistProxy\";\n// import Hypermap from \"./Hypermap\";\n\nexport default class HyperProxyHandler {\n\tbrowserContext;\n\n\tconstructor(browserContext, tab) {\n\t\tthis.browserContext = browserContext;\n\t\tthis.tab = tab;\n\t}\n\n\tget(target, prop) {\n\t\tif (prop === '$') {\n\t\t\treturn async (key, body) => {\n\t\t\t\tconst node = target.at(key);\n\t\t\t\tlet promises = [];\n\t\t\t\t\n\t\t\t\tpromises.push(\n\t\t\t\t\tthis.browserContext.evaluate(async (path, key, body) => {\n\t\t\t\t\t\tconst innerNode = globalThis.hypermap.at(...path);\n\t\t\t\t\t\tawait innerNode.$(key, body);\n\t\t\t\t\t}, target.path(), key, body)\n\t\t\t\t);\n\n\t\t\t\tif (!node.attributes.rels?.includes('transclude')) {\n\t\t\t\t\tpromises.push(this.browserContext.waitForNavigation());\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t\tawait this.tab.syncData();\n\t\t\t}\n\t\t}\n\n\t\tif (prop === 'set') {\n\t\t\treturn async (key, value) => {\n\t\t\t\tawait this.browserContext.evaluate(async (path, key, value) => {\n\t\t\t\t\tconst innerNode = globalThis.hypermap.at(...path);\n\t\t\t\t\tawait innerNode.set(key, value);\n\t\t\t\t}, target.path(), key, value);\n\t\t\t\tawait this.tab.syncData();\n\t\t\t\treturn this.tab.hypermap.at(target.path());\n\t\t\t}\n\t\t}\n\n\t\tconst value = target[prop];\n\t\tif (value instanceof Function) {\n\t\t\treturn (...args) => {\n\t\t\t\tconst res = target[prop].apply(target, args);\n\t\t\t\tif (res?.isCollection && res.isCollection()) {\n\t\t\t\t\treturn new Proxy(res, this);\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t};\n\t\t}\n\t\treturn value;\n\t}\n}\n"],"names":["HyperProxyHandler","browserContext","constructor","tab","get","target","prop","key","body","node","at","promises","push","evaluate","path","innerNode","globalThis","hypermap","$","attributes","rels","includes","waitForNavigation","Promise","all","syncData","value","set","Function","args","res","apply","isCollection","Proxy"],"mappings":"AAAA,iDAAiD;AACjD,qCAAqC;;;;;+BAErC;;aAAqBA;;AAAN,MAAMA;IACpBC,eAAe;IAEfC,YAAYD,cAAc,EAAEE,GAAG,CAAE;QAChC,IAAI,CAACF,cAAc,GAAGA;QACtB,IAAI,CAACE,GAAG,GAAGA;IACZ;IAEAC,IAAIC,MAAM,EAAEC,IAAI,EAAE;QACjB,IAAIA,SAAS,KAAK;YACjB,OAAO,OAAOC,KAAKC,OAAS;gBAC3B,MAAMC,OAAOJ,OAAOK,EAAE,CAACH;gBACvB,IAAII,WAAW,EAAE;gBAEjBA,SAASC,IAAI,CACZ,IAAI,CAACX,cAAc,CAACY,QAAQ,CAAC,OAAOC,MAAMP,KAAKC,OAAS;oBACvD,MAAMO,YAAYC,WAAWC,QAAQ,CAACP,EAAE,IAAII;oBAC5C,MAAMC,UAAUG,CAAC,CAACX,KAAKC;gBACxB,GAAGH,OAAOS,IAAI,IAAIP,KAAKC;gBAGxB,IAAI,CAACC,KAAKU,UAAU,CAACC,IAAI,EAAEC,SAAS,eAAe;oBAClDV,SAASC,IAAI,CAAC,IAAI,CAACX,cAAc,CAACqB,iBAAiB;gBACpD,CAAC;gBAED,MAAMC,QAAQC,GAAG,CAACb;gBAClB,MAAM,IAAI,CAACR,GAAG,CAACsB,QAAQ;YACxB;QACD,CAAC;QAED,IAAInB,SAAS,OAAO;YACnB,OAAO,OAAOC,KAAKmB,QAAU;gBAC5B,MAAM,IAAI,CAACzB,cAAc,CAACY,QAAQ,CAAC,OAAOC,MAAMP,KAAKmB,QAAU;oBAC9D,MAAMX,YAAYC,WAAWC,QAAQ,CAACP,EAAE,IAAII;oBAC5C,MAAMC,UAAUY,GAAG,CAACpB,KAAKmB;gBAC1B,GAAGrB,OAAOS,IAAI,IAAIP,KAAKmB;gBACvB,MAAM,IAAI,CAACvB,GAAG,CAACsB,QAAQ;gBACvB,OAAO,IAAI,CAACtB,GAAG,CAACc,QAAQ,CAACP,EAAE,CAACL,OAAOS,IAAI;YACxC;QACD,CAAC;QAED,MAAMY,QAAQrB,MAAM,CAACC,KAAK;QAC1B,IAAIoB,iBAAiBE,UAAU;YAC9B,OAAO,CAAC,GAAGC,OAAS;gBACnB,MAAMC,MAAMzB,MAAM,CAACC,KAAK,CAACyB,KAAK,CAAC1B,QAAQwB;gBACvC,IAAIC,KAAKE,gBAAgBF,IAAIE,YAAY,IAAI;oBAC5C,OAAO,IAAIC,MAAMH,KAAK,IAAI;gBAC3B,CAAC;gBACD,OAAOA;YACR;QACD,CAAC;QACD,OAAOJ;IACR;AACD"}