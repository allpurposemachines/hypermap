{"version":3,"sources":["../src/main.js"],"sourcesContent":["import puppeteer from 'puppeteer';\nimport * as fs from 'fs';\nimport Hypermap from './Hypermap.js';\n\nexport class Client {\n\tbrowser;\n\n\tstatic async launch() {\n\t\tconst client = new Client();\n\t\tclient.browser = await puppeteer.launch();\n\t\treturn client;\n\t}\n\n\tasync newTab(options = {}) {\n\t\tconst tab = await this.browser?.newPage();\n\n\t\tif (options.debug) {\n\t\t\tawait tab?.setRequestInterception(true);\n\t\t\ttab?.on('console', msg => console.log('PAGE LOG:', msg.text()));\n\t\t}\n\n\t\tawait tab.exposeFunction('contentChanged', () => {\n\t\t\ttab.emit('contentchanged');\n\t\t});\n\n\t\tconst shim = fs.readFileSync(new URL('assets/shim.js', import.meta.url), 'utf8');\n\t\ttab.on('load', async () => {\n\t\t\tawait tab.evaluate(shim);\n\t\t});\n\n\t\ttab.data = async function () {\n\t\t\tconst hypermapJson = await this.evaluate(() => {\n\t\t\t\treturn globalThis.serializedHypermap();\n\t\t\t});\n\t\t\treturn Hypermap.fromJSON(hypermapJson, [], [], null, this);\n\t\t}\n\n\t\ttab.fetch = async function (path) {\n\t\t\tconst node = (await this.data()).at(...path);\n\t\t\tif (node.attributes.rels?.includes('transclude')) {\n\t\t\t\tawait this.evaluate(async path => {\n\t\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\t\tawait hypermap.at(...path).fetch();\n\t\t\t\t}, path);\n\t\t\t} else {\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tthis.waitForNavigation(),\n\t\t\t\t\tthis.evaluate(path => {\n\t\t\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\t\t\thypermap.at(...path).fetch();\n\t\t\t\t\t}, path)\n\t\t\t\t]);\n\t\t\t}\n\t\t};\n\n\t\ttab.set = async function(path, value) {\n\t\t\tawait this.evaluate((path, value) => {\n\t\t\t\tglobalThis.hypermap.at(...path.slice(0, -1)).set(path.at(-1), value);\n\t\t\t}, path, value);\n\t\t}\n\n\t\treturn tab;\n\t}\n\n\tasync tabs() {\n\t\treturn await this.browser?.pages();\n\t}\n\n\tasync close() {\n\t\tawait this.browser?.close();\n\t}\n}\n"],"names":["Client","browser","launch","client","puppeteer","newTab","options","tab","newPage","debug","setRequestInterception","on","msg","console","log","text","exposeFunction","emit","shim","fs","readFileSync","URL","evaluate","data","hypermapJson","globalThis","serializedHypermap","Hypermap","fromJSON","fetch","path","node","at","attributes","rels","includes","hypermap","Promise","all","waitForNavigation","set","value","slice","tabs","pages","close"],"mappings":";;;;+BAIaA;;aAAAA;;kEAJS;4DACF;iEACC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEd,MAAMA;IACZC,QAAQ;IAER,aAAaC,SAAS;QACrB,MAAMC,SAAS,IAAIH;QACnBG,OAAOF,OAAO,GAAG,MAAMG,kBAAS,CAACF,MAAM;QACvC,OAAOC;IACR;IAEA,MAAME,OAAOC,UAAU,CAAC,CAAC,EAAE;QAC1B,MAAMC,MAAM,MAAM,IAAI,CAACN,OAAO,EAAEO;QAEhC,IAAIF,QAAQG,KAAK,EAAE;YAClB,MAAMF,KAAKG,uBAAuB,IAAI;YACtCH,KAAKI,GAAG,WAAWC,CAAAA,MAAOC,QAAQC,GAAG,CAAC,aAAaF,IAAIG,IAAI;QAC5D,CAAC;QAED,MAAMR,IAAIS,cAAc,CAAC,kBAAkB,IAAM;YAChDT,IAAIU,IAAI,CAAC;QACV;QAEA,MAAMC,OAAOC,IAAGC,YAAY,CAAC,IAAIC,IAAI,kBAAkB,sDAAkB;QACzEd,IAAII,EAAE,CAAC,QAAQ,UAAY;YAC1B,MAAMJ,IAAIe,QAAQ,CAACJ;QACpB;QAEAX,IAAIgB,IAAI,GAAG,iBAAkB;YAC5B,MAAMC,eAAe,MAAM,IAAI,CAACF,QAAQ,CAAC,IAAM;gBAC9C,OAAOG,WAAWC,kBAAkB;YACrC;YACA,OAAOC,iBAAQ,CAACC,QAAQ,CAACJ,cAAc,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI;QAC1D;QAEAjB,IAAIsB,KAAK,GAAG,eAAgBC,IAAI,EAAE;YACjC,MAAMC,OAAO,AAAC,CAAA,MAAM,IAAI,CAACR,IAAI,EAAC,EAAGS,EAAE,IAAIF;YACvC,IAAIC,KAAKE,UAAU,CAACC,IAAI,EAAEC,SAAS,eAAe;gBACjD,MAAM,IAAI,CAACb,QAAQ,CAAC,OAAMQ,OAAQ;oBACjC,oCAAoC;oBACpC,MAAMM,SAASJ,EAAE,IAAIF,MAAMD,KAAK;gBACjC,GAAGC;YACJ,OAAO;gBACN,MAAMO,QAAQC,GAAG,CAAC;oBACjB,IAAI,CAACC,iBAAiB;oBACtB,IAAI,CAACjB,QAAQ,CAACQ,CAAAA,OAAQ;wBACrB,oCAAoC;wBACpCM,SAASJ,EAAE,IAAIF,MAAMD,KAAK;oBAC3B,GAAGC;iBACH;YACF,CAAC;QACF;QAEAvB,IAAIiC,GAAG,GAAG,eAAeV,IAAI,EAAEW,KAAK,EAAE;YACrC,MAAM,IAAI,CAACnB,QAAQ,CAAC,CAACQ,MAAMW,QAAU;gBACpChB,WAAWW,QAAQ,CAACJ,EAAE,IAAIF,KAAKY,KAAK,CAAC,GAAG,CAAC,IAAIF,GAAG,CAACV,KAAKE,EAAE,CAAC,CAAC,IAAIS;YAC/D,GAAGX,MAAMW;QACV;QAEA,OAAOlC;IACR;IAEA,MAAMoC,OAAO;QACZ,OAAO,MAAM,IAAI,CAAC1C,OAAO,EAAE2C;IAC5B;IAEA,MAAMC,QAAQ;QACb,MAAM,IAAI,CAAC5C,OAAO,EAAE4C;IACrB;AACD"}