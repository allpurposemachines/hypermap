{"version":3,"sources":["../src/Mech.js"],"sourcesContent":["import puppeteer from 'puppeteer';\nimport * as fs from 'fs';\nimport { Tab } from './Tab.js';\n\nconst Mech = {\n\tdebug: false,\n\tdebugRequestHandler: null,\n\t/** @type { puppeteer.Browser | null } */\n\tbrowser: null,\n\n\t/** @param { string } url */\n\tasync open(url) {\n\t\tif (!this.browser) {\n\t\t\tthis.browser = await puppeteer.launch();\n\t\t}\n\n\t\tconst page = await this.browser.newPage();\n\t\t\n\t\tif (this.debug) {\n\t\t\tawait page.setRequestInterception(true);\n\t\t\tpage.on('console', msg => console.log('PAGE LOG:', msg.text()));\n\t\t\tif (this.debugRequestHandler) {\n\t\t\t\tpage.on('request', this.debugRequestHandler);\n\t\t\t}\n\t\t}\n\n\t\tawait page.exposeFunction('contentChanged', () => {\n\t\t\tpage.emit('contentchanged');\n\t\t});\n\n\t\tconst shim = fs.readFileSync(new URL('assets/shim.js', import.meta.url), 'utf8');\n\t\tpage.on('load', async () => {\n\t\t\tawait page.evaluate(shim);\n\t\t});\n\n\t\tconst tab = new Tab(page);\n\t\tawait tab.open(url); //), { waitUntil: 'networkidle0' });\n\t\treturn tab;\n\t},\n\n\tasync tabs() {\n\t\treturn await this.browser?.pages();\n\t},\n\n\tasync close() {\n\t\tawait this.browser?.close();\n\t}\n}\n\nexport { Mech, Tab };\n"],"names":["Mech","Tab","debug","debugRequestHandler","browser","open","url","puppeteer","launch","page","newPage","setRequestInterception","on","msg","console","log","text","exposeFunction","emit","shim","fs","readFileSync","URL","evaluate","tab","tabs","pages","close"],"mappings":";;;;;;;;;;;IAiDSA,IAAI;eAAJA;;IAAMC,GAAG;eAAHA,QAAG;;;kEAjDI;4DACF;qBACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEpB,MAAMD,OAAO;IACZE,OAAO;IACPC,qBAAqB;IACrB,uCAAuC,GACvCC,SAAS;IAET,0BAA0B,GAC1B,MAAMC,MAAKC,GAAG;QACb,IAAI,CAAC,IAAI,CAACF,OAAO,EAAE;YAClB,IAAI,CAACA,OAAO,GAAG,MAAMG,kBAAS,CAACC,MAAM;QACtC;QAEA,MAAMC,OAAO,MAAM,IAAI,CAACL,OAAO,CAACM,OAAO;QAEvC,IAAI,IAAI,CAACR,KAAK,EAAE;YACf,MAAMO,KAAKE,sBAAsB,CAAC;YAClCF,KAAKG,EAAE,CAAC,WAAWC,CAAAA,MAAOC,QAAQC,GAAG,CAAC,aAAaF,IAAIG,IAAI;YAC3D,IAAI,IAAI,CAACb,mBAAmB,EAAE;gBAC7BM,KAAKG,EAAE,CAAC,WAAW,IAAI,CAACT,mBAAmB;YAC5C;QACD;QAEA,MAAMM,KAAKQ,cAAc,CAAC,kBAAkB;YAC3CR,KAAKS,IAAI,CAAC;QACX;QAEA,MAAMC,OAAOC,IAAGC,YAAY,CAAC,IAAIC,IAAI,kBAAkB,sDAAkB;QACzEb,KAAKG,EAAE,CAAC,QAAQ;YACf,MAAMH,KAAKc,QAAQ,CAACJ;QACrB;QAEA,MAAMK,MAAM,IAAIvB,QAAG,CAACQ;QACpB,MAAMe,IAAInB,IAAI,CAACC,MAAM,oCAAoC;QACzD,OAAOkB;IACR;IAEA,MAAMC;QACL,OAAO,MAAM,IAAI,CAACrB,OAAO,EAAEsB;IAC5B;IAEA,MAAMC;QACL,MAAM,IAAI,CAACvB,OAAO,EAAEuB;IACrB;AACD"}