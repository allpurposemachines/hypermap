{"version":3,"sources":["../src/Tab.js"],"sourcesContent":["import Hypermap from './Hypermap.js';\n\nexport default class Tab extends EventTarget {\n\tpage;\n\n\tconstructor(page) {\n\t\tsuper();\n\t\tthis.page = page;\n\n\t\tthis.page.on('contentchanged', () => {\n\t\t\tthis.dispatchEvent(new Event('contentchanged'));\n\t\t});\n\t}\n\n\tasync goto(...args) {\n\t\tawait this.page.goto(...args);\n\t}\n\n\turl() {\n\t\treturn this.page.url();\n\t}\n\n\tasync data() {\n\t\tconst hypermapJson = await this.page.evaluate(() => {\n\t\t\treturn globalThis.serializedHypermap();\n\t\t});\n\t\treturn Hypermap.fromLiteral(hypermapJson);\n\t}\n\n\tasync fetch(path) {\n\t\tconst node = (await this.data()).at(...path);\n\n\t\tif (node == undefined) {\n\t\t\tthrow new Error('Node does not exist');\n\t\t}\n\n\t\tif (node.attributes === undefined) {\n\t\t\tthrow new Error('Attempting to fetch a non-fetchable node');\n\t\t}\n\n\t\tif (node.attributes.rels?.includes('transclude')) {\n\t\t\tawait this.page.evaluate(async path => {\n\t\t\t\tawait globalThis.hypermap.at(...path).fetch();\n\t\t\t}, path);\n\t\t} else {\n\t\t\tawait Promise.all([\n\t\t\t\tthis.page.waitForNavigation(),\n\t\t\t\tthis.page.evaluate(path => {\n\t\t\t\t\tglobalThis.hypermap.at(...path).fetch();\n\t\t\t\t}, path)\n\t\t\t]);\n\t\t}\n\t}\n\n\tasync set(path, value) {\n\t\tawait this.page.evaluate((path, value) => {\n\t\t\tglobalThis.hypermap.at(...path.slice(0, -1)).set(path.at(-1), value);\n\t\t}, path, value);\n\t}\n}\n"],"names":["Tab","EventTarget","page","constructor","on","dispatchEvent","Event","goto","args","url","data","hypermapJson","evaluate","globalThis","serializedHypermap","Hypermap","fromLiteral","fetch","path","node","at","undefined","Error","attributes","rels","includes","hypermap","Promise","all","waitForNavigation","set","value","slice"],"mappings":";;;;+BAEA;;aAAqBA;;iEAFA;;;;;;AAEN,MAAMA,YAAYC;IAChCC,KAAK;IAELC,YAAYD,IAAI,CAAE;QACjB,KAAK;QACL,IAAI,CAACA,IAAI,GAAGA;QAEZ,IAAI,CAACA,IAAI,CAACE,EAAE,CAAC,kBAAkB,IAAM;YACpC,IAAI,CAACC,aAAa,CAAC,IAAIC,MAAM;QAC9B;IACD;IAEA,MAAMC,KAAK,GAAGC,IAAI,EAAE;QACnB,MAAM,IAAI,CAACN,IAAI,CAACK,IAAI,IAAIC;IACzB;IAEAC,MAAM;QACL,OAAO,IAAI,CAACP,IAAI,CAACO,GAAG;IACrB;IAEA,MAAMC,OAAO;QACZ,MAAMC,eAAe,MAAM,IAAI,CAACT,IAAI,CAACU,QAAQ,CAAC,IAAM;YACnD,OAAOC,WAAWC,kBAAkB;QACrC;QACA,OAAOC,iBAAQ,CAACC,WAAW,CAACL;IAC7B;IAEA,MAAMM,MAAMC,IAAI,EAAE;QACjB,MAAMC,OAAO,AAAC,CAAA,MAAM,IAAI,CAACT,IAAI,EAAC,EAAGU,EAAE,IAAIF;QAEvC,IAAIC,QAAQE,WAAW;YACtB,MAAM,IAAIC,MAAM,uBAAuB;QACxC,CAAC;QAED,IAAIH,KAAKI,UAAU,KAAKF,WAAW;YAClC,MAAM,IAAIC,MAAM,4CAA4C;QAC7D,CAAC;QAED,IAAIH,KAAKI,UAAU,CAACC,IAAI,EAAEC,SAAS,eAAe;YACjD,MAAM,IAAI,CAACvB,IAAI,CAACU,QAAQ,CAAC,OAAMM,OAAQ;gBACtC,MAAML,WAAWa,QAAQ,CAACN,EAAE,IAAIF,MAAMD,KAAK;YAC5C,GAAGC;QACJ,OAAO;YACN,MAAMS,QAAQC,GAAG,CAAC;gBACjB,IAAI,CAAC1B,IAAI,CAAC2B,iBAAiB;gBAC3B,IAAI,CAAC3B,IAAI,CAACU,QAAQ,CAACM,CAAAA,OAAQ;oBAC1BL,WAAWa,QAAQ,CAACN,EAAE,IAAIF,MAAMD,KAAK;gBACtC,GAAGC;aACH;QACF,CAAC;IACF;IAEA,MAAMY,IAAIZ,IAAI,EAAEa,KAAK,EAAE;QACtB,MAAM,IAAI,CAAC7B,IAAI,CAACU,QAAQ,CAAC,CAACM,MAAMa,QAAU;YACzClB,WAAWa,QAAQ,CAACN,EAAE,IAAIF,KAAKc,KAAK,CAAC,GAAG,CAAC,IAAIF,GAAG,CAACZ,KAAKE,EAAE,CAAC,CAAC,IAAIW;QAC/D,GAAGb,MAAMa;IACV;AACD"}