{"version":3,"sources":["../src/Tab.js"],"sourcesContent":["import { EventEmitter } from 'node:events';\nimport Hypermap from './Hypermap.js';\nimport HyperProxyHandler from './HyperProxyHandler.js';\n\nexport class Tab extends EventEmitter {\n\t/** @type { import('puppeteer').Page } */\n\tpage;\n\t/** @type { Hypermap | null } */\n\thypermap = null;\n\n\t/** @param { import('puppeteer').Page } page */\n\tconstructor(page) {\n\t\tsuper();\n\t\tthis.page = page;\n\n\t\t// @ts-expect-error\n\t\tthis.page.on('contentchanged', async () => {\n\t\t\tawait this.syncData();\n\t\t\tthis.emit('contentchanged');\n\t\t});\n\n\t\tthis.page.on('console', msg => {\n\t\t\tthis.emit('console', msg);\n\t\t});\n\t}\n\n\t/**\n\t * @param { string } url\n\t * @param { import('puppeteer').WaitForOptions= } options\n\t*/\n\tasync open(url, options = { waitUntil: 'networkidle0' }) {\n\t\tawait this.page.goto(url, options);\n\t\tawait this.syncData();\n\t}\n\n\tasync close() {\n\t\tawait this.page.close();\n\t}\n\n\turl() {\n\t\treturn this.page.url();\n\t}\n\n\tasync syncData() {\n\t\tconst hypermapJson = await this.page.evaluate(() => {\n\t\t\t// @ts-expect-error\n\t\t\treturn globalThis.serializedHypermap();\n\t\t});\n\t\tconst unwrappedHypermap = Hypermap.fromLiteral(hypermapJson);\n\t\tconst proxy = new HyperProxyHandler(this.page, this);\n\t\tthis.hypermap = /** @type { Hypermap } */ (new Proxy(unwrappedHypermap, proxy));\n\t}\n}\n"],"names":["Tab","EventEmitter","page","hypermap","constructor","on","syncData","emit","msg","open","url","options","waitUntil","goto","close","hypermapJson","evaluate","globalThis","serializedHypermap","unwrappedHypermap","Hypermap","fromLiteral","proxy","HyperProxyHandler","Proxy"],"mappings":";;;;+BAIaA;;aAAAA;;4BAJgB;iEACR;0EACS;;;;;;AAEvB,MAAMA,YAAYC,wBAAY;IACpC,uCAAuC,GACvCC,KAAK;IACL,8BAA8B,GAC9BC,WAAW,IAAI,CAAC;IAEhB,6CAA6C,GAC7CC,YAAYF,IAAI,CAAE;QACjB,KAAK;QACL,IAAI,CAACA,IAAI,GAAGA;QAEZ,mBAAmB;QACnB,IAAI,CAACA,IAAI,CAACG,EAAE,CAAC,kBAAkB,UAAY;YAC1C,MAAM,IAAI,CAACC,QAAQ;YACnB,IAAI,CAACC,IAAI,CAAC;QACX;QAEA,IAAI,CAACL,IAAI,CAACG,EAAE,CAAC,WAAWG,CAAAA,MAAO;YAC9B,IAAI,CAACD,IAAI,CAAC,WAAWC;QACtB;IACD;IAEA;;;CAGA,GACA,MAAMC,KAAKC,GAAG,EAAEC,UAAU;QAAEC,WAAW;IAAe,CAAC,EAAE;QACxD,MAAM,IAAI,CAACV,IAAI,CAACW,IAAI,CAACH,KAAKC;QAC1B,MAAM,IAAI,CAACL,QAAQ;IACpB;IAEA,MAAMQ,QAAQ;QACb,MAAM,IAAI,CAACZ,IAAI,CAACY,KAAK;IACtB;IAEAJ,MAAM;QACL,OAAO,IAAI,CAACR,IAAI,CAACQ,GAAG;IACrB;IAEA,MAAMJ,WAAW;QAChB,MAAMS,eAAe,MAAM,IAAI,CAACb,IAAI,CAACc,QAAQ,CAAC,IAAM;YACnD,mBAAmB;YACnB,OAAOC,WAAWC,kBAAkB;QACrC;QACA,MAAMC,oBAAoBC,iBAAQ,CAACC,WAAW,CAACN;QAC/C,MAAMO,QAAQ,IAAIC,0BAAiB,CAAC,IAAI,CAACrB,IAAI,EAAE,IAAI;QACnD,IAAI,CAACC,QAAQ,GAAG,uBAAuB,GAAI,IAAIqB,MAAML,mBAAmBG;IACzE;AACD"}